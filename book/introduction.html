<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>API</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html" class="active"><strong aria-hidden="true">1.</strong> API</a></li><li class="chapter-item expanded "><a href="deployment.html"><strong aria-hidden="true">2.</strong> Deployment</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="cool-corridors-api"><a class="header" href="#cool-corridors-api">Cool Corridors API</a></h1>
<p>Welcome to the Cool Corridors API! </p>
<p>This project aims to inform NYC communities of Air Quality in their neighborhoods
using our very own IAQI score!</p>
<h2 id="rapidapi-users"><a class="header" href="#rapidapi-users">RapidAPI Users</a></h2>
<p>If you are a RapidAPI user, you can use the following url to access the API: https://coolcorridors.p.rapidapi.com. RapidAPI provides a gateway url that allows users to acces the API from within RapidAPI's website. </p>
<h2 id="api"><a class="header" href="#api">API</a></h2>
<p>The API lives on https://cool-corridors-api-service.onrender.com. This is the base url. All other endpoints are relative to this url.</p>
<h3 id="data"><a class="header" href="#data">Data</a></h3>
<p>PurpleAir returns their data as a json object formatted as such:</p>
<pre><code class="language-json">{
    // metadata
    &quot;fields&quot;: [
        &quot;name&quot;,
        &quot;location&quot;,
        &quot;pm2.5&quot;,
        &quot;temperature&quot;,
        ...
    ],
    &quot;location_types&quot;: [
        &quot;outside&quot;,
        &quot;inside&quot;
    ],
    // data is a list of lists. each list/array in data is the data for a certain sensor
    &quot;data&quot;: [
        [
            1284751,
            &quot;City College&quot;,
            56,
            ...
        ],
        ...
    ]

}

</code></pre>
<p>The <code>/score</code> endpoint will take the above json and format it into the following python dictionary:</p>
<pre><code class="language-py">    {
        &quot;zip_code&quot;: int,
        &quot;pm2.5&quot;: float,
        &quot;pm2.5_30minute&quot;: float,
        &quot;pm2.5_60minute&quot;: float,
        &quot;pm2.5_1week&quot;: float,
        &quot;temperature&quot;: int,
        &quot;IAQI&quot;: dict{
            &quot;score&quot;: int,
            &quot;category&quot;: str
            }
    }
</code></pre>
<p>The frontend will then take this json object and embed data into components in the HTML. Data is subject to change as we add different functionalities.</p>
<h2 id="endpoints"><a class="header" href="#endpoints">Endpoints</a></h2>
<!-- TODO: Move this somewhere more "fitting" -->
<details>
 <summary><code>GET</code> <code><b>/data?zipcode={zipcode}&read_key={read_key}</b></code></summary>
<h3 id="parameters"><a class="header" href="#parameters">Parameters</a></h3>
<blockquote>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>data type</th><th>description</th></tr></thead><tbody>
<tr><td>zipcode</td><td>required</td><td>int</td><td>zipcode of user's location</td></tr>
<tr><td>api_key</td><td>required</td><td>string</td><td>user's purpleair API key</td></tr>
</tbody></table>
</div></blockquote>
<h3 id="responses"><a class="header" href="#responses">Responses</a></h3>
<blockquote>
<div class="table-wrapper"><table><thead><tr><th>http code</th><th>content-type</th><th>response</th></tr></thead><tbody>
<tr><td><code>200</code></td><td><code>application/json</code></td><td><code>JSON object</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{error: &quot;Invalid zipcode&quot;}</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{&quot;error&quot;: &quot;No sensors found within the range of &quot;x&quot; miles.&quot;}</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{&quot;error&quot;: &quot;No read key or zipcode provided.&quot;}</code></td></tr>
</tbody></table>
</div></blockquote>
<h3 id="example-response"><a class="header" href="#example-response">Example response</a></h3>
<blockquote>
<pre><code class="language-py">   {
       &quot;zip_code&quot;: 11101,
       &quot;pm2.5&quot;: 2.4,
       &quot;pm2.5_30minute&quot;: 2.4,
       &quot;pm2.5_60minute&quot;: 2.6,
       &quot;pm2.5_1week&quot;: 3.4,
       &quot;temperature&quot;: 52,
       &quot;IAQI&quot;: {
           &quot;score&quot;: 105,
           &quot;descriptor&quot;: &quot;Good&quot;
          }
   }
</code></pre>
</blockquote>
</details>
<details>
 <summary><code>GET</code> <code><b>/score?zipcode={zipcode}&read_key={read_key}</b></code></summary>
<h3 id="parameters-1"><a class="header" href="#parameters-1">Parameters</a></h3>
<blockquote>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>data type</th><th>description</th></tr></thead><tbody>
<tr><td>zipcode</td><td>required</td><td>int</td><td>zipcode of user's location</td></tr>
<tr><td>api_key</td><td>required</td><td>string</td><td>user's purpleair API key</td></tr>
</tbody></table>
</div></blockquote>
<h3 id="responses-1"><a class="header" href="#responses-1">Responses</a></h3>
<blockquote>
<div class="table-wrapper"><table><thead><tr><th>http code</th><th>content-type</th><th>response</th></tr></thead><tbody>
<tr><td><code>200</code></td><td><code>application/json</code></td><td><code>JSON object</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{error: &quot;Invalid zipcode&quot;}</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{&quot;error&quot;: &quot;No sensors found within the range of &quot;x&quot; miles.&quot;}</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{&quot;error&quot;: &quot;No read key or zipcode provided.&quot;}</code></td></tr>
</tbody></table>
</div></blockquote>
<h3 id="example-response-1"><a class="header" href="#example-response-1">Example response</a></h3>
<blockquote>
<pre><code class="language-py">   {
       &quot;IAQI&quot;: 105,
       &quot;zipcode&quot;: 11101
   }
</code></pre>
</blockquote>
</details>
<details>
 <summary><code>GET</code> <code><b>/descriptor?zipcode={zipcode}&read_key={read_key}</b></code></summary>
<h3 id="parameters-2"><a class="header" href="#parameters-2">Parameters</a></h3>
<blockquote>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>data type</th><th>description</th></tr></thead><tbody>
<tr><td>zipcode</td><td>required</td><td>int</td><td>zipcode of user's location</td></tr>
<tr><td>api_key</td><td>required</td><td>string</td><td>user's purpleair API key</td></tr>
</tbody></table>
</div></blockquote>
<h3 id="responses-2"><a class="header" href="#responses-2">Responses</a></h3>
<blockquote>
<div class="table-wrapper"><table><thead><tr><th>http code</th><th>content-type</th><th>response</th></tr></thead><tbody>
<tr><td><code>200</code></td><td><code>application/json</code></td><td><code>JSON object</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{error: &quot;Invalid zipcode&quot;}</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{&quot;error&quot;: &quot;No sensors found within the range of &quot;x&quot; miles.&quot;}</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{&quot;error&quot;: &quot;No read key or zipcode provided.&quot;}</code></td></tr>
</tbody></table>
</div></blockquote>
<h3 id="example-response-2"><a class="header" href="#example-response-2">Example response</a></h3>
<blockquote>
<pre><code class="language-py">   {
       &quot;description&quot;: &quot;Good&quot;,
       &quot;zipcode&quot;: 11101
   }
</code></pre>
</blockquote>
</details>
<details>
 <summary><code>GET</code> <code><b>/color?zipcode={zipcode}&read_key={read_key}</b></code></summary>
<h3 id="parameters-3"><a class="header" href="#parameters-3">Parameters</a></h3>
<blockquote>
<div class="table-wrapper"><table><thead><tr><th>name</th><th>type</th><th>data type</th><th>description</th></tr></thead><tbody>
<tr><td>zipcode</td><td>required</td><td>int</td><td>zipcode of user's location</td></tr>
<tr><td>api_key</td><td>required</td><td>string</td><td>user's purpleair API key</td></tr>
</tbody></table>
</div></blockquote>
<h3 id="responses-3"><a class="header" href="#responses-3">Responses</a></h3>
<blockquote>
<div class="table-wrapper"><table><thead><tr><th>http code</th><th>content-type</th><th>response</th></tr></thead><tbody>
<tr><td><code>200</code></td><td><code>application/json</code></td><td><code>JSON object</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{error: &quot;Invalid zipcode&quot;}</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{&quot;error&quot;: &quot;No sensors found within the range of &quot;x&quot; miles.&quot;}</code></td></tr>
<tr><td><code>400</code></td><td><code>application/json</code></td><td><code>{&quot;error&quot;: &quot;No read key or zipcode provided.&quot;}</code></td></tr>
</tbody></table>
</div></blockquote>
<h3 id="example-response-3"><a class="header" href="#example-response-3">Example response</a></h3>
<blockquote>
<pre><code class="language-py">   {
       &quot;color&quot;: &quot;0xFF00FF&quot;,
       &quot;zipcode&quot;: 11101
   }
</code></pre>
</blockquote>
</details>
<h2 id="creating-a-new-api-endpoint"><a class="header" href="#creating-a-new-api-endpoint">Creating a new API endpoint</a></h2>
<p>All endpoints are defined inside <code>/src/app.py</code>. To create a new endpoint, simply create a new function and add a new route to the <code>app</code> object. </p>
<p>For example, to create a new endpoint called <code>/test</code>, you would do the following:</p>
<pre><code class="language-py">@app.route(&quot;/test&quot;)
def test():
    return &quot;Hello World!&quot;
</code></pre>
<p>This creates a new endpoint called <code>/test</code> that returns the string &quot;Hello World!&quot; when called.</p>
<p>The function name can be anything, but it is recommended to keep it consistent with the endpoint name.</p>
<p>Flask offers many different ways to return data. For more information, see the <a href="https://flask.palletsprojects.com/en/2.2.x/quickstart/">Flask documentation</a>. </p>
<p>You can:</p>
<ul>
<li>return a string literal</li>
<li>return a json object</li>
<li>render a template (html file)</li>
<li>redirect to a different route or url</li>
<li>return a file</li>
<li>etc...</li>
</ul>
<h2 id="helper-functions"><a class="header" href="#helper-functions">Helper Functions</a></h2>
<p>There are a few helper functions that are used throughout the codebase. These functions are defined in <code>/src/helpers.py</code>.</p>
<p>It is recommended to  define new endpoints in <code>/src/app.py</code>, and define any helper functions in <code>/src/helpers.py</code> to keep the codebase organized.</p>
<p>Our main helper function is <code>get_info()</code>. This function does most of the heavy lifting for the API endpoints. </p>
<p>We begin by getting the query parameters from the request. 
Query strings are accessed through the flask <code>request</code> object.</p>
<pre><code class="language-py">zipcode = request.args.get(&quot;zipcode&quot;)
read_key = request.args.get(&quot;read_key&quot;)
</code></pre>
<p>If the zipcode or read key is not provided, we return an error message. </p>
<p>We then convert the zipcode into a latitude and longitude. We use the latitude and longitude to create a binding box around the zipcode. This binding box is used to query the PurpleAir API for sensors within the zipcode. To provide PurpleAir with the bounding box and the many other fields we access, we use the <code>requests.get()</code> function from teh requests library. The function allows us to pass in a url and a dictionary of query parameters. </p>
<pre><code class="language-py">url = &quot;https://www.api.purpleair.com/v1/sensors/&quot;
params = {
    &quot;fields&quot;: &quot;sensor_index,latitude,longitude,temperature,IAQI&quot;,
    &quot;key&quot;: read_key,
    &quot;nwlat&quot;: nwlat,
    &quot;nwlng&quot;: nwlng,
    &quot;selat&quot;: selat,
    &quot;selng&quot;: selng,
}
response = requests.get(url, params=params)
</code></pre>
<p>If we are to move away from using purpleair as our data source, we can simply change the url and the contents of the <code>params</code> dictionary.</p>
<p>If no sensors are found, we return an error message. Otherwise, we take the returned sensor data and format it accordingly to be returned.</p>
<p>To send data back as a json object, we use the <code>jsonify()</code> function from the flask library. </p>
<pre><code class="language-py">@app.route(&quot;/example&quot;)
def example():
    return jsonify({
        &quot;IAQI&quot;: IAQI,
        &quot;zipcode&quot;: zipcode
    })
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next" href="deployment.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next" href="deployment.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
