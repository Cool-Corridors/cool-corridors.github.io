<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Deployment - Cool Corridors Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Documentation for the Cool Corridors project">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Setting up</li><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="api.html"><strong aria-hidden="true">2.</strong> API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="endpoints.html"><strong aria-hidden="true">2.1.</strong> Endpoints</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="endpoints/endpoint-data.html"><strong aria-hidden="true">2.1.1.</strong> /data</a></li><li class="chapter-item expanded "><a href="endpoints/endpoint-score.html"><strong aria-hidden="true">2.1.2.</strong> /score</a></li><li class="chapter-item expanded "><a href="endpoints/endpoint-descriptor.html"><strong aria-hidden="true">2.1.3.</strong> /descriptor</a></li><li class="chapter-item expanded "><a href="endpoints/endpoint-color.html"><strong aria-hidden="true">2.1.4.</strong> /color</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="client.html"><strong aria-hidden="true">3.</strong> Client</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="client-routes/home-route.html"><strong aria-hidden="true">3.1.</strong> /</a></li><li class="chapter-item expanded "><a href="client-routes/search.html"><strong aria-hidden="true">3.2.</strong> /search</a></li><li class="chapter-item expanded "><a href="client-routes/about.html"><strong aria-hidden="true">3.3.</strong> /about</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Support</li><li class="chapter-item expanded "><a href="support/acessing.html"><strong aria-hidden="true">4.</strong> Accessing repositories</a></li><li class="chapter-item expanded "><a href="support/new_route.html"><strong aria-hidden="true">5.</strong> Creating a new API endpoint</a></li><li class="chapter-item expanded "><a href="support/helper_functions.html"><strong aria-hidden="true">6.</strong> Helper functions</a></li><li class="chapter-item expanded "><a href="deployment.html" class="active"><strong aria-hidden="true">7.</strong> Deployment</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Cool Corridors Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="deployment"><a class="header" href="#deployment">Deployment</a></h1>
<h2 id="1-creating-an-account"><a class="header" href="#1-creating-an-account">1. Creating an account:</a></h2>
<p>In order to use the API from anywhere on any machine, one would need to deploy the API to a hosting service. The hosting service we picked is <a href="https://render.com">render</a>. </p>
<p>(if an account has not already been created) When signing up for an account, make sure to do so using the GitHub account which owns the repository containing the code you'd like to deploy. This is to make it convenient for quickly selecting repositories on your GitHub account direcly from within <a href="https://render.com">render</a>.</p>
<h2 id="2-creating-a-new-service"><a class="header" href="#2-creating-a-new-service">2. Creating a new service:</a></h2>
<ol>
<li>After logging in, click the 'new +' button near the profile icon and select webservice. Selecting webservice allows us to deploy applications that will be serving data to its users. Please check out the <a href="https://render.com/docs/web-services">Web Services documentation</a> on render.</li>
</ol>
<p><img src="https://user-images.githubusercontent.com/97417536/227998672-545b6d4c-d7a5-4f14-b137-43d182c32331.png" alt="image" /></p>
<ol start="2">
<li>Select the GitHub repository containing the code you'd like to deploy. In this case, it will be <code>cool-corridors-API</code></li>
</ol>
<p><img src="https://user-images.githubusercontent.com/97417536/228000965-951b5bcb-3af5-420a-a80e-abf0fc992b9d.png" alt="image" /></p>
<ol start="3">
<li>You will now be greeted with this menu to fill out:</li>
</ol>
<p><img src="https://user-images.githubusercontent.com/97417536/228002777-a42f487c-812e-4986-a030-c91679dfcb48.png" alt="image" /></p>
<p>Here's what each field mean, feel free to also checkout the <a href="https://render.com/docs/web-services#deploy-your-own-code">documentation</a>:</p>
<ul>
<li><code>Name</code>: A name for your Web Service</li>
<li><code>Runtime</code>: The programming language of your code, which is Python. </li>
<li><code>Region</code>: The <a href="https://render.com/docs/regions">geographic region</a> to deploy to</li>
<li><code>Branch</code>: The git branch to build. At the moment, the branch used is <code>gunicorn-testing</code></li>
<li><code>Root directory</code>: The directory which the application is ran from. Keep this as default because the root directory contains a file named <code>run.py</code> which is responsble for running the code in <code>/src</code></li>
<li><code>Build Command</code>: The command to build your Web Service. Because all the API dependencies of the project are in <code>requirements.txt</code>, set this field to <code>pip install -r requirements.txt</code>. If new packages/dependencies are later on added to the project, run <code>pip freeze &gt; requirements.txt</code> within the project root directory to get an up to date <code>requirements.txt</code> file.</li>
<li><code>Start Command</code>: The command to start your Web Service. The command is <code>gunicorn run:app</code> where <code>app.py</code> is in the root directory of the repository. We decided to use <a href="https://gunicorn.org/">gunicorn</a> because it can make the application handle more requests per second. More on this is elaborated below. </li>
</ul>
<h3 id="why-use-gunicorn"><a class="header" href="#why-use-gunicorn">Why use gunicorn?</a></h3>
<p>Flask is a light weight framework great for developing applications locally on your machine. However, flask on its own can only handle one request at a time in sequential order, making it less ideal for deployment into production. </p>
<p>Turns out that its best practice to run flask code using <a href="https://gunicorn.org/">gunicorn</a>. 
This is because gunicorn uses a <a href="https://docs.gunicorn.org/en/stable/design.html">pre-fork model</a> which has 
multiple processes called &quot;workers&quot; that can indidivually handle API requests. These processes are handled by a &quot;Master Process&quot; that manages the number of running workers based on how many API requests are made at a given time. 
The result is that we have a faster application that can handle multiple requests at the same time as opposed to just one at a time. </p>
<p><a href="https://blog.ironboundsoftware.com/2016/06/27/faster-flask-need-gunicorn/">article</a></p>
<h2 id="plan"><a class="header" href="#plan">Plan</a></h2>
<p>Scrolling further down from <code>Start Command</code>, you can select the plan to host the API with. You can specify the amount of RAM and how many CPUs your Web Service requires. We selected the free plan for now, but higher tiers can handle more traffic load.</p>
<p><img src="https://user-images.githubusercontent.com/97417536/228021569-ada52763-f00f-4b4f-a22c-e9549d925dae.png" alt="image" /></p>
<h2 id="advanced"><a class="header" href="#advanced">Advanced:</a></h2>
<p>Within <code>Advanced</code>, you may also specify environment variables, secrets, persistent disk, health check path, and whether or not to auto deploy on every git push.</p>
<p><img src="https://user-images.githubusercontent.com/97417536/228029117-93da1d34-41e4-4569-9381-fea5f443030a.png" alt="image" /></p>
<p>For this section, we need to do two things:</p>
<ol>
<li>Add an environment variable to specifiy the Python version for render to use for deployment. </li>
</ol>
<pre><code>Key: PYTHON_VERSION
Value: 3.9.10
</code></pre>
<p><img src="https://user-images.githubusercontent.com/97417536/228029988-7ef15efa-2c03-4915-b5ac-45c082ccdc8f.png" alt="image" /></p>
<ol start="2">
<li>Add a <code>.env</code> file containing PurpleAir API read and write keys. Conventionally, <code>.env</code> is added to the <code>.gitignore</code> of project repositories in order to keep senstitive information needed to run the API hidden and safe. However, there's no way for render to have access for this file unless we explicitly specify it here:</li>
</ol>
<p><img src="https://user-images.githubusercontent.com/97417536/228032291-aa7e0043-bc7d-49a2-8ece-4b59b76d33bb.png" alt="image" /></p>
<ul>
<li>
<p>Filename: <code>.env</code></p>
</li>
<li>
<p>contents: </p>
<pre><code class="language-ini">Make sure to have the keys enclosed in quotiation marks

READ_KEY = &quot;INSERT_READ_KEY_HERE&quot;
WRITE_KEY = &quot;INSERT_WRITE_KEY_HERE&quot;
</code></pre>
</li>
</ul>
<p><strong>Once all of this has been set, click the Create Web Service button all the way at the bottom:</strong></p>
<p><img src="https://user-images.githubusercontent.com/97417536/228036086-da582277-8da2-4405-983d-41f64e7298f6.png" alt="image" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="support/helper_functions.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="support/helper_functions.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
